<body *ngIf="retrospective">
<div class="foreground">

  <div class="scrollable">
    <div class="locked">
      <br>
      <div class="title-background-left">
        <h1 matTooltip="{{retrospective.description}}">{{retrospective.title}}</h1>
      </div>
      <div class="title-background-right">
        <img class="icon" id="icon_wipe" src="../../../assets/images/broom.png" (click)="cleanRetroBoardDialog()"/>
      </div>
    </div>
    <br>

    <div class="board_area">
      <div class="example-container" *ngFor="let column of retrospective.retroColumns">
        <div class="row column-title-holder">

          <div class="column-title">
            <h2 matTooltip="{{column.title}}" *ngIf="!hasEnabledColumnTitleEditing(column)">{{column.title}}</h2>
          </div>

          <div class="icon_menu">
            <img class="icon" id="icon_menu" src="../../../assets/images/icon_dot_menu.png"
                 [matMenuTriggerFor]="menu">
            <mat-menu #menu="matMenu">
              <button mat-menu-item class="dropdownitem" (click)="addFamily(column)>
                {{dict.CREATE_NEW_FAMILY_BTN}}
              </button>
              <button mat-menu-item class="dropdownitem" (click)="enableColumnTitleEditing(true, column)">
                {{dict.EDIT_COLUMN_BTN}}
              </button>
              <button mat-menu-item class="dropdownitem" (click)="emptyColumn(column)">
                {{dict.EMPTY_COLUMN_BTN}}
              </button>
              <button mat-menu-item class="dropdownitem" (click)="deleteColumnDialog(column)">
                {{dict.DELETE_COLUMN_BTN}}
              </button>
            </mat-menu>
          </div>
        </div>


        <div class="box-content" *ngIf="hasEnabledColumnTitleEditing(column)">
          <input type="text" #newtitle value="{{column.title}}">
          <br>
          <button class="TLbtn btn-small btn-color-primary editTitleBtn"
                  (click)="updateColumnTitle(column, newtitle.value)"
                  (keyup.enter)="updateColumnTitle(column, newtitle.value)">
            {{dict.EDIT_BTN}}
          </button>
        </div>
        <div cdkDropList #element="cdkDropList" [attr.id]="column.title" [cdkDropListData]="column.retroItems"
             [cdkDropListConnectedTo]="getColumnNames(element)" class="example-list"
             (cdkDropListDropped)="drop($event, column, null)">
          <div *ngFor="let item of column.retroItems">
            <div *ngIf="isRetroCard(item)" class="example-box" cdkDrag>
              <div class="box-content" *ngIf="!hasEnabledContentEditing(item)">
                {{item.content}}
              </div>
              <div class="box-content" *ngIf="hasEnabledContentEditing(item)">
                <textarea type="text" class="editContentInput" #content value="{{item.content}}"></textarea>
                <button class="TLbtn btn-small btn-color-primary"
                        (click)="updateContent(castRetroCard(item), content.value)"
                        (keyup.enter)="updateContent(castRetroCard(item), content.value)">
                        {{dict.EDIT_BTN}}
                </button>
              </div>

              <div class="icons">
                <img class="icon" id="icon_edit" src="../../../assets/images/icon_edit.png"
                     (click)="enableContentEditing(true, castRetroCard(item))" alt=""/>
                <img class="icon" id="icon_delete" src="../../../assets/images/icon_delete.png"
                     (click)="deleteCardDialog(castRetroCard(item))" alt=""/>
              </div>
              <div class="votecount row">
                <div class="vote-up vote-text">+{{castRetroCard(item).upVotes}}</div>
                <div class="vote-text">&nbsp;</div>
                <div class="vote-down vote-text">-{{castRetroCard(item).downVotes}}</div>
              </div>
              <div class="smiley-icons" id="expandable">
                <img class="icon" src="../../../assets/images/smiley_happy.png" (click)="voteUp(castRetroCard(item))"
                     alt=""/>
                <img class="icon" src="../../../assets/images/smiley_neutral.png" alt=""/>
                <img class="icon" src="../../../assets/images/smiley_down.png" (click)="voteDown(castRetroCard(item))"
                     alt=""/>
              </div>
            </div>
            <div *ngIf="isFamily(item)" cdkDrag>
              <mat-expansion-panel style="padding-bottom: 25px; padding-top: 25px;">
                <mat-expansion-panel-header>
                  {{item.content}}
                </mat-expansion-panel-header>
                <div cdkDropList #element="cdkDropList" [attr.id]="item.id"
                     [cdkDropListData]="castFamily(item).retroCards"
                     [cdkDropListConnectedTo]="getColumnNames(element)"
                     (cdkDropListDropped)="drop($event, column, castFamily(item))"
                     style="background-color: black">
                  <div class="example-box" *ngFor="let item of castFamily(item).retroCards"
                       cdkDrag>{{item.content}}</div>
                </div>
              </mat-expansion-panel>
            </div>
          </div>
        </div>
        <div class="example-container-toaddcard">
          <h6 (click)="enableEditing(true, column)" *ngIf="!hasEnabledEditing(column)">+ {{dict.CREATE_NEW_CARD_BTN}}
          </h6>
          <div class="animated-item" *ngIf="hasEnabledEditing(column)">
            <form [formGroup]="cardGroup">
              <div>
                <mat-form-field [formGroup]="cardGroup" class="inputfield">
                  <label class="inputfield">
                    <input class="inputfield" matInput #card placeholder="{{dict.FILL_IN_DESC_FORM}}"
                           formControlName="content" value="">
                  </label>
                </mat-form-field>
              </div>
              <div>
                <button [disabled]="!cardGroup.valid" mat-button
                        (click)="enableEditing(false, column); addCard(column); openSnackBar(dict.SNACKBAR_SUCCESS_ADD, 'Ok')"
                        (keyup.enter)="enableEditing(false, column); addCard(column); openSnackBar(dict.SNACKBAR_SUCCESS_ADD, 'Ok')"
                        class="TLbtn btn-small btn-color-primary">
                  {{dict.ADD_BTN}}
                </button>
                <button mat-button (click)="enableEditing(false, column);"
                        class="TLbtn btn-small btn-color-secondary btn-margin-left">
                  {{dict.CANCEL_BTN}}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="example-container-toadd">
        <h4 class="clickable_element" (click)="enable=true">+ {{dict.CREATE_NEW_COLUMN_BTN}}</h4>
        <div class="animated-item" *ngIf="enable">
          <form [formGroup]="listGroup">
            <div>
              <mat-form-field [formGroup]="listGroup" class="inputfield">
                <input matInput #column placeholder="{{dict.FILL_IN_TITLE_FORM}}" class="inputfield"
                       formControlName="title" value="">
              </mat-form-field>
            </div>
            <div>
              <button [disabled]="!listGroup.valid" mat-button
                      (click)="enable=false; addColumn(column.value); openSnackBar(dict.SNACKBAR_SUCCESS_ADD, 'Ok')"
                      (keyup.enter)="enable=false; addColumn(column.value); openSnackBar(dict.SNACKBAR_SUCCESS_ADD, 'Ok')"
                      class="TLbtn btn-small btn-color-primary click_should_disable">
                {{dict.ADD_BTN}}
              </button>
              <button mat-button (click)="enable=false"
                      class="TLbtn btn-small btn-color-secondary clickable_element_closed btn-margin-left">
                {{dict.CANCEL_BTN}}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
